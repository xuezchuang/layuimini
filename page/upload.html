<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>zyupload上传实例</title>
    <!-- <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all"> -->
    <!-- <link rel="stylesheet" href="../lib/layui-v2.9.3/dist/css/layui.css" media="all"> -->
    <link rel="stylesheet" href="../lib/layui-v2.9.3/src/css/layui.css" media="all">
    <link rel="stylesheet" href="../lib/jq-module/zyupload/zyupload-1.0.0.min.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">


    <style>
        .layui-upload-img {
            width: 92px;
            height: 92px;
            margin: 0 10px 10px 0;
        }

        hr {
            margin: 32px 0;
        }
    </style>
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <blockquote class="layui-elem-quote">
                上传组件使用开源项目：zyupload<br>
                <a href="http://www.jq22.com/jquery-info14213" target="_blank"
                    class="layui-btn layui-btn-danger">zyupload</a>
            </blockquote>
            <div id="zyupload" class="zyupload"></div>
            <pre class="layui-code">测试下</pre>
        </div>
    </div>

    <hr>

    <div class="layui-upload">
        <button type="button" class="layui-btn" id="test1" name="123">上传图片</button>
        <div class="layui-upload-list">
            <img class="layui-upload-img" src="" id="demo1">
            <p id="demoText"></p>
        </div>
    </div>

    <div class="layui-progress layui-progress-big" lay-showPercent="yes" lay-filter="demo">
        <div class="layui-progress-bar" lay-percent=""></div>
    </div>

    <hr>

    <hr><br>
    <div class="layui-upload-drag" id="test8">
        <i class="layui-icon">&#xe67c;</i>
        <p>点击上传，或将文件拖拽到此处</p>
    </div>
    <hr><br>

    <hr><br>
    绑定原始文件域：<input type="file" name="file" id="test9">
    <hr><br>

    <!-- <script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script> -->
    <script src="../lib/jquery-4.0.0/jquery.js" charset="utf-8"></script>
    <!-- <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script> -->
    <!-- <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script> -->
    <script src="../lib/layui-v2.9.3/src/layui.js" charset="utf-8"></script>
    <!-- <script src="../lib/jq-module/zyupload/zyupload-1.0.0.min.js" charset="utf-8"></script> -->
    <script src="../lib/jq-module/zyupload/zyupload-1.0.0.js" charset="utf-8"></script>
    <script type="text/javascript">
        $(function () {
            // 初始化插件
            $("#zyupload").zyUpload({
                width: "650px",                 // 宽度
                height: "400px",                 // 宽度
                itemWidth: "140px",                 // 文件项的宽度
                itemHeight: "115px",                 // 文件项的高度
                url: "api/upload",  // 上传文件的路径
                fileType: ["jpg", "png", "txt", "js", "exe"],// 上传文件的类型
                fileSize: 51200000,                // 上传文件的大小
                multiple: true,                    // 是否可以多个文件上传
                dragDrop: true,                    // 是否可以拖动上传文件
                tailor: true,                    // 是否可以裁剪图片
                del: true,                    // 是否可以删除文件
                finishDel: false,  				  // 是否在上传文件完成后删除预览
                /* 外部获得的回调接口 */
                onSelect: function (selectFiles, allFiles) {    // 选择文件的回调方法  selectFile:当前选中的文件  allFiles:还没上传的全部文件
                    console.info("当前选择了以下文件：");
                    console.info(selectFiles);
                },
                onDelete: function (file, files) {              // 删除一个文件的回调方法 file:当前删除的文件  files:删除之后的文件
                    console.info("当前删除了此文件：");
                    console.info(file.name);
                },
                onSuccess: function (file, response) {          // 文件上传成功的回调方法
                    console.info("此文件上传成功：");
                    console.info(file.name);
                    console.info("此文件上传到服务器地址：");
                    console.info(response);
                    $("#uploadInf").append("<p>上传成功，文件地址是：" + response + "</p>");
                },
                onFailure: function (file, response) {          // 文件上传失败的回调方法
                    console.info("此文件上传失败：");
                    console.info(file.name);
                },
                onComplete: function (response) {           	  // 上传完成的回调方法
                    console.info("文件上传完成");
                    console.info(response);
                }
            });

        });
    </script>

    <!-- <script src="../lib/layui-v2.6.3/layui.js" src1="https://cdn.staticfile.org/layui/2.7.6/layui.js"></script> -->
    <script src="../lib/layui-v2.9.3/src/layui.js" charset="utf-8"></script>
    <script>
        layui.use(['upload', 'element', 'form'], function () {
            var $ = layui.$;
            var upload = layui.upload;
            var element = layui.element;

            // 模拟接口
            var url = 'api/upload';//'https://httpbin.org/post';

            // 创建实例
            var uploadInst = upload.render({
                elem: '#test1',
                url: url, // 若需模拟上传过程，而不真实上传文件，可使用开源的 HTTP 模拟接口: httpbin
                // size: 2000, //限制文件大小，单位 KB
                // accept: 'file',
                method: 'get',
                fileAccept: 'image/*',
                exts: 'jpg|png|gif|bmp|jpeg|pdf',
                data: { // 额外参数
                    a: 1,
                    b: function () {
                        return 2
                    }
                },
                choose: function (obj) {
                    console.log('choose', obj);
                },
                before: function (obj) {
                    //预读本地文件示例，不支持ie8
                    obj.preview(function (index, file, result) {
                        $('#demo1').attr('src', result); //图片链接（base64）
                    });

                    return;
                    layer.msg('不允许上传')
                    return false;
                },
                done: function (res, index) {

                    //如果上传失败
                    if (res.code > 0) {
                        return layer.msg('上传失败');
                    }
                    //上传成功
                    console.log(res, index);
                },
                error: function (index, upload) {
                    this.item.html('重选上传');

                    //演示失败状态，并实现重传
                    var demoText = $('#demoText');
                    demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试啊啊啊测试</a>');
                    demoText.find('.demo-reload').on('click', function () {
                        uploadInst.upload();
                    });

                    element.progress('demo', '0%');
                },
                progress: function (n, elem, res, index) {
                    console.log(n + '%', elem, res, index); //获取进度百分比
                    element.progress('demo', n + '%'); //可配合 layui 进度条元素使用
                }
            });

            // 重载上述实例
            uploadInst.reload({
                field: 'avatar',
                accept: 'images', // 只允许上传图片
                acceptMime: 'image/*', // 只筛选图片
                // size: 2,
            });

            // 演示多图片上传
            upload.render({
                elem: '#test2',
                url: url, // 实际使用时改成您自己的上传接口即可
                multiple: true, // 多文件
                unified: true, // 一起上传 ---  2.8.8+
                accept: 'images',
                number: 3, // 同时上传的数量
                size: 1024,
                before: function (obj) {
                    // 预读本地文件示例，不支持ie8
                    obj.preview(function (index, file, result) {
                        $('#demo2').append('<img src="' + result + '" alt="' + file.name + '" class="layui-upload-img">')
                    });

                    // this.files = obj.pushFile();
                },
                done: function (res, index) {
                    // 上传完毕
                    console.log(res, index)
                },
                allDone: function (obj) {
                    console.log(obj)
                }
            });

            // 演示多文件列表 ---  本示例仅演示未开启 unified 属性的情况
            var demoListView = $('#demoList');
            var uploadListIns = upload.render({
                elem: '#testList',
                url: url, // 实际使用时改成您自己的上传接口即可
                accept: 'file',
                multiple: true,
                number: 5,
                auto: false,
                bindAction: '#testListAction',
                // size: 30,
                choose: function (obj) {
                    var files = this.files = obj.pushFile(); // 将每次选择的文件追加到文件队列
                    //读取本地文件
                    obj.preview(function (index, file, result) {
                        var tr = $(['<tr id="upload-' + index + '">'
                            , '<td>' + file.name + '</td>'
                            , '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>'
                            , '<td><div class="layui-progress" lay-filter="progress-' + index + '"><div class="layui-progress-bar" lay-percent=""></div></div></td>'
                            , '<td>'
                            , '<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
                            , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                            , '</td>'
                            , '</tr>'].join(''));

                        //单个重传
                        tr.find('.demo-reload').on('click', function () {
                            obj.upload(index, file);
                        });

                        //删除
                        var that = this;
                        tr.find('.demo-delete').on('click', function () {
                            console.log(files, index);
                            delete files[index]; //删除对应的文件
                            tr.remove();
                            uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                        });

                        demoListView.append(tr);

                        element.render('progress');
                    });
                },
                done: function (res, index, upload) {
                    //if(res.code == 0){ //上传成功
                    var tr = demoListView.find('tr#upload-' + index)
                        , tds = tr.children();
                    tds.eq(3).html(''); //清空操作
                    delete this.files[index]; //删除文件队列已经上传成功的文件
                    return;
                    //}
                    this.error(index, upload);
                },
                allDone: function (obj) {
                    console.log(obj)
                },
                error: function (index, upload) {
                    var tr = demoListView.find('tr#upload-' + index)
                        , tds = tr.children();
                    tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
                },
                progress: function (n, elem, e, index) {
                    console.log(n);
                    console.log(index);
                    element.progress('progress-' + index, n + '%'); //进度条
                }
            });

            upload.render({
                elem: '.test333',
                url: url,
                accept: 'file',
                choose: function (obj) {
                    console.log(this.elem);
                },
                done: function (res) {
                    console.log(res);
                }
            });

            upload.render({
                elem: '.testm',
                done: function (res, index, upload) {
                    //获取当前触发上传的元素，一般用于 elem 绑定 class 的情况，注意：此乃 layui 2.1.0 新增
                    var item = this.item;

                }
            })

            /*
            upload.render({
            elem: '#test33',
            url: '',
            accept: 'file',
            done: function(res){
                console.log(res)
            }
            });*/

            upload.render({
                elem: '#test4',
                url: url, // 实际使用时改成您自己的上传接口即可
                accept: 'video',
                done: function (res) {
                    console.log(res)
                }
            });

            upload.render({
                elem: '#test5',
                url: '',
                accept: 'audio',
                done: function (res) {
                    console.log(res)
                }
            });


            //手动上传
            upload.render({
                elem: '#test6',
                url: url, // 实际使用时改成您自己的上传接口即可
                auto: false,
                // multiple: true,
                bindAction: '#test7',
                choose: function (obj) {
                    var that = this;
                    obj.preview(function (index, file) {
                        that.elem.after('<span class="layui-inline layui-upload-choose">' + file.name + '</span>');
                        console.log(file.name);
                        //obj.resetFile(index, file, '123.jpg');
                    });
                },
                before: function () {
                    console.log(345);
                },
                done: function (res) {
                    console.log(res);
                }
            });

            upload.render({
                elem: '#test8',
                url: url, // 实际使用时改成您自己的上传接口即可
                done: function (res) {
                    console.log(res);
                }
            });

            upload.render({
                elem: '#test9',
                url: url, // 实际使用时改成您自己的上传接口即可
                done: function (res) {
                    console.log(res);
                }
            });



        });
    </script>
</body>

</html>