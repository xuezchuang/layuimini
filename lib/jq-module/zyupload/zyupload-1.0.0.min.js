(function(t){t.Jcrop=function(e,n){function o(t){return parseInt(t)+"px"}function a(t){return parseInt(t)+"%"}function s(t){return U.baseClass+"-"+t}function r(e){var i=t(e).offset();return[i.left,i.top]}function l(t){return[t.pageX-st[0],t.pageY-st[1]]}function d(t){t!=G&&(dt.setCursor(t),G=t)}function u(t,e){if(st=r(A),dt.setCursor("move"==t?t:t+"-resize"),"move"==t)return dt.activateHandlers(p(e),b);var i=rt.getFixed(),n=f(t),o=rt.getCorner(f(n));rt.setPressed(rt.getCorner(n)),rt.setCurrent(o),dt.activateHandlers(c(t,i),b)}function c(t,e){return function(i){if(U.aspectRatio)switch(t){case"e":case"w":i[1]=e.y+1;break;case"n":case"s":i[0]=e.x+1}else switch(t){case"e":case"w":i[1]=e.y2;break;case"n":case"s":i[0]=e.x2}rt.setCurrent(i),lt.update()}}function p(t){var e=t;return ut.watchKeys(),function(t){rt.moveOffset([t[0]-e[0],t[1]-e[1]]),e=t,lt.update()}}function f(t){switch(t){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function v(t){return function(e){return!U.disabled&&(!("move"==t&&!U.allowMove)&&(Q=!0,u(t,l(e)),e.stopPropagation(),e.preventDefault(),!1))}}function g(t,e,i){var n=t.width(),o=t.height();n>e&&e>0&&(n=e,o=e/t.width()*t.height()),o>i&&i>0&&(o=i,n=i/t.height()*t.width()),Z=t.width()/n,K=t.height()/o,t.width(n).height(o)}function m(t){return{x:parseInt(t.x*Z),y:parseInt(t.y*K),x2:parseInt(t.x2*Z),y2:parseInt(t.y2*K),w:parseInt(t.w*Z),h:parseInt(t.h*K)}}function b(t){var e=rt.getFixed();e.w>U.minSelect[0]&&e.h>U.minSelect[1]?(lt.enableHandles(),lt.done()):lt.release(),dt.setCursor(U.allowSelect?"crosshair":"default")}function x(t){if(U.disabled)return!1;if(!U.allowSelect)return!1;Q=!0,st=r(A),lt.disableHandles(),d("crosshair");var e=l(t);return rt.setPressed(e),dt.activateHandlers(y,b),ut.watchKeys(),lt.update(),t.stopPropagation(),t.preventDefault(),!1}function y(t){rt.setCurrent(t),lt.update()}function _(){var e=t("<div></div>").addClass(s("tracker")),i=!!document.documentMode;return i&&e.css({opacity:0,backgroundColor:"white"}),e}function F(t){function e(){window.setTimeout(w,d)}var i=t[0]/Z,n=t[1]/K,o=t[2]/Z,a=t[3]/K;if(!V){var s=rt.flipCoords(i,n,o,a),r=rt.getFixed(),l=initcr=[r.x,r.y,r.x2,r.y2],d=U.animationDelay,u=l[0],c=l[1],p=(o=l[2],a=l[3],s[0]-initcr[0]),f=s[1]-initcr[1],h=s[2]-initcr[2],v=s[3]-initcr[3],g=0,m=U.swingSpeed;lt.animMode(!0);var w=function(){g+=(100-g)/m,l[0]=u+g/100*p,l[1]=c+g/100*f,l[2]=o+g/100*h,l[3]=a+g/100*v,g<100?e():lt.done(),g>=99.8&&(g=100),S(l)};e()}}function I(t){S([t[0]/Z,t[1]/K,t[2]/Z,t[3]/K])}function S(t){rt.setPressed([t[0],t[1]]),rt.setCurrent([t[2],t[3]]),lt.update()}function C(e){"object"!=typeof e&&(e={}),U=t.extend(U,e),"function"!=typeof U.onChange&&(U.onChange=function(){}),"function"!=typeof U.onSelect&&(U.onSelect=function(){})}function z(){return m(rt.getFixed())}function D(){return rt.getFixed()}function k(t){C(t),E()}function P(){U.disabled=!0,lt.disableHandles(),lt.setCursor("default"),dt.setCursor("default")}function H(){U.disabled=!1,E()}function M(){lt.done(),dt.activateHandlers(null,null)}function L(){W.remove(),Y.show()}function E(t){U.allowResize?t?lt.enableOnly():lt.enableHandles():lt.disableHandles(),dt.setCursor(U.allowSelect?"crosshair":"default"),lt.setCursor(U.allowMove?"move":"default"),W.css("backgroundColor",U.bgColor),"setSelect"in U&&(I(n.setSelect),lt.done(),delete U.setSelect),"trueSize"in U&&(Z=U.trueSize[0]/R,K=U.trueSize[1]/B),N=U.maxSize[0]||0,X=U.maxSize[1]||0,$=U.minSize[0]||0,J=U.minSize[1]||0,"outerImage"in U&&(A.attr("src",U.outerImage),delete U.outerImage),lt.refresh()}e=e,n=n;if("object"!=typeof e&&(e=t(e)[0]),"object"!=typeof n&&(n={}),!("trackDocument"in n)){var T=!!document.documentMode;n.trackDocument=!T;var O=document.documentMode&&8===document.documentMode;O&&(n.trackDocument=!0)}if(!("keySupport"in n)){T=!!document.documentMode;n.keySupport=!T}var j={trackDocument:!1,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,borderOpacity:.4,handleOpacity:.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:!0,allowMove:!0,allowResize:!0,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}},U=j;C(n);var Y=t(e),A=Y.clone().removeAttr("id").css({position:"absolute"});A.width(Y.width()),A.height(Y.height()),Y.after(A).hide(),g(A,U.boxWidth,U.boxHeight);var R=A.width(),B=A.height(),W=t("<div />").width(R).height(B).addClass(s("holder")).css({position:"relative",backgroundColor:U.bgColor}).insertAfter(Y).append(A);U.addClass&&W.addClass(U.addClass);var N,X,$,J,Z,K,Q,G,V,q,tt=t("<img />").attr("src",A.attr("src")).css("position","absolute").width(R).height(B),et=t("<div />").width(a(100)).height(a(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(tt),it=t("<div />").width(a(100)).height(a(100)).css("zIndex",320),nt=t("<div />").css({position:"absolute",zIndex:300}).insertBefore(A).append(et,it),ot=U.boundary,at=_().width(R+2*ot).height(B+2*ot).css({position:"absolute",top:o(-ot),left:o(-ot),zIndex:290}).mousedown(x),st=r(A),rt=function(){function t(t){t=s(t);v=p=t[0],g=f=t[1]}function e(t){t=s(t);u=t[0]-v,c=t[1]-g,v=t[0],g=t[1]}function i(){return[u,c]}function n(t){var e=t[0],i=t[1];0>p+e&&(e-=e+p),0>f+i&&(i-=i+f),B<g+i&&(i+=B-(g+i)),R<v+e&&(e+=R-(v+e)),p+=e,v+=e,f+=i,g+=i}function o(t){var e=a();switch(t){case"ne":return[e.x2,e.y];case"nw":return[e.x,e.y];case"se":return[e.x2,e.y2];case"sw":return[e.x,e.y2]}}function a(){if(!U.aspectRatio)return l();var t,e,i=U.aspectRatio,n=U.minSize[0]/Z,o=(U.minSize[1],U.maxSize[0]/Z),a=U.maxSize[1]/K,s=v-p,u=g-f,c=Math.abs(s),m=Math.abs(u),b=c/m;return 0==o&&(o=10*R),0==a&&(a=10*B),b<i?(e=g,w=m*i,t=s<0?p-w:w+p,t<0?(t=0,h=Math.abs((t-p)/i),e=u<0?f-h:h+f):t>R&&(t=R,h=Math.abs((t-p)/i),e=u<0?f-h:h+f)):(t=v,h=c/i,e=u<0?f-h:f+h,e<0?(e=0,w=Math.abs((e-f)*i),t=s<0?p-w:w+p):e>B&&(e=B,w=Math.abs(e-f)*i,t=s<0?p-w:w+p)),t>p?(t-p<n?t=p+n:t-p>o&&(t=p+o),e=e>f?f+(t-p)/i:f-(t-p)/i):t<p&&(p-t<n?t=p-n:p-t>o&&(t=p-o),e=e>f?f+(p-t)/i:f-(p-t)/i),t<0?(p-=t,t=0):t>R&&(p-=t-R,t=R),e<0?(f-=e,e=0):e>B&&(f-=e-B,e=B),last=d(r(p,f,t,e))}function s(t){return t[0]<0&&(t[0]=0),t[1]<0&&(t[1]=0),t[0]>R&&(t[0]=R),t[1]>B&&(t[1]=B),[t[0],t[1]]}function r(t,e,i,n){var o=t,a=i,s=e,r=n;return i<t&&(o=i,a=t),n<e&&(s=n,r=e),[Math.round(o),Math.round(s),Math.round(a),Math.round(r)]}function l(){var t=v-p,e=g-f;if(N&&Math.abs(t)>N&&(v=t>0?p+N:p-N),X&&Math.abs(e)>X&&(g=e>0?f+X:f-X),J&&Math.abs(e)<J&&(g=e>0?f+J:f-J),$&&Math.abs(t)<$&&(v=t>0?p+$:p-$),p<0&&(v-=p,p-=p),f<0&&(g-=f,f-=f),v<0&&(p-=v,v-=v),g<0&&(f-=g,g-=g),v>R){var i=v-R;p-=i,v-=i}if(g>B){i=g-B;f-=i,g-=i}if(p>R){i=p-B;g-=i,f-=i}if(f>B){i=f-B;g-=i,f-=i}return d(r(p,f,v,g))}function d(t){return{x:t[0],y:t[1],x2:t[2],y2:t[3],w:t[2]-t[0],h:t[3]-t[1]}}var u,c,p=0,f=0,v=0,g=0;return{flipCoords:r,setPressed:t,setCurrent:e,getOffset:i,moveOffset:n,getCorner:o,getFixed:a}}(),lt=function(){function e(e){var i=t("<div />").css({position:"absolute",opacity:U.borderOpacity}).addClass(s(e));return et.append(i),i}function n(e,i){var n=t("<div />").mousedown(v(e)).css({cursor:e+"-resize",position:"absolute",zIndex:i});return it.append(n),n}function r(t){return n(t,z++).css({top:o(1-H),left:o(1-H),opacity:U.handleOpacity}).addClass(s("handle"))}function l(t){var e=U.handleSize,i=H,s=e,r=e,l=i,d=i;switch(t){case"n":case"s":r=a(100);break;case"e":case"w":s=a(100)}return n(t,z++).width(r).height(s).css({top:o(1-l),left:o(1-d)})}function d(t){for(i in t)k[t[i]]=r(t[i])}function u(t){var e=Math.round(t.h/2-H),i=Math.round(t.w/2-H),n=(west=1-H,t.w-H),a=t.h-H;"e"in k&&k.e.css({top:o(e),left:o(n)})&&k.w.css({top:o(e)})&&k.s.css({top:o(a),left:o(i)})&&k.n.css({left:o(i)}),"ne"in k&&k.ne.css({left:o(n)})&&k.se.css({top:o(a),left:o(n)})&&k.sw.css({top:o(a)}),"b"in k&&k.b.css({top:o(a)})&&k.r.css({left:o(n)})}function c(t,e){tt.css({top:o(-e),left:o(-t)}),nt.css({top:o(e),left:o(t)})}function p(t,e){nt.width(t).height(e)}function f(){var t=rt.getFixed();rt.setPressed([t.x,t.y]),rt.setCurrent([t.x2,t.y2]),h()}function h(){if(C)return g()}function g(){var t=rt.getFixed();p(t.w,t.h),c(t.x,t.y),U.drawBorders&&D.right.css({left:o(t.w-1)})&&D.bottom.css({top:o(t.h-1)}),P&&u(t),C||w(),U.onChange(m(t))}function w(){nt.show(),A.css("opacity",U.bgOpacity),C=!0}function b(){F(),nt.hide(),A.css("opacity",1),C=!1}function x(){P&&(u(rt.getFixed()),it.show())}function y(){if(P=!0,U.allowResize)return u(rt.getFixed()),it.show(),!0}function F(){P=!1,it.hide()}function I(t){(V=t)?F():y()}function S(){I(!1),f()}var C,z=370,D={},k={},P=!1,H=U.handleOffset;if(U.drawBorders){var M=!!document.documentMode;D={top:e("hline").css("top",o(M?-1:0)),bottom:e("hline"),left:e("vline"),right:e("vline")}}U.dragEdges&&(k.t=l("n"),k.b=l("s"),k.r=l("e"),k.l=l("w")),U.sideHandles&&d(["n","s","e","w"]),U.cornerHandles&&d(["sw","nw","ne","se"]);var L=_().mousedown(v("move")).css({cursor:"move",position:"absolute",zIndex:360});return et.append(L),F(),{updateVisible:h,update:g,release:b,refresh:f,setCursor:function(t){L.css("cursor",t)},enableHandles:y,enableOnly:function(){P=!0},showHandles:x,disableHandles:F,animMode:I,done:S}}(),dt=function(){function e(){at.css({zIndex:450}),u&&t(document).mousemove(n).mouseup(o)}function i(){at.css({zIndex:290}),u&&t(document).unbind("mousemove",n).unbind("mouseup",o)}function n(t){r(l(t))}function o(t){return t.preventDefault(),t.stopPropagation(),Q&&(Q=!1,d(l(t)),U.onSelect(m(rt.getFixed())),i(),r=function(){},d=function(){}),!1}function a(t,i){return Q=!0,r=t,d=i,e(),!1}function s(t){at.css("cursor",t)}var r=function(){},d=function(){},u=U.trackDocument;return u||at.mousemove(n).mouseup(o).mouseout(o),A.before(at),{activateHandlers:a,setCursor:s}}(),ut=function(){function e(){U.keySupport&&(a.show(),a.focus())}function i(t){a.hide()}function n(t,e,i){U.allowMove&&(rt.moveOffset([e,i]),lt.updateVisible()),t.preventDefault(),t.stopPropagation()}function o(t){if(t.ctrlKey)return!0;q=!!t.shiftKey;var e=q?10:1;switch(t.keyCode){case 37:n(t,-e,0);break;case 39:n(t,e,0);break;case 38:n(t,0,-e);break;case 40:n(t,0,e);break;case 27:lt.release();break;case 9:return!0}return nothing(t)}var a=t('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(o).blur(i),s=t("<div />").css({position:"absolute",overflow:"hidden"}).append(a);return U.keySupport&&s.insertBefore(A),{watchKeys:e}}();it.hide(),E(!0);var ct={animateTo:F,setSelect:I,setOptions:k,tellSelect:z,tellScaled:D,disable:P,enable:H,cancel:M,focus:ut.watchKeys,getBounds:function(){return[R*Z,B*K]},getWidgetSize:function(){return[R,B]},release:lt.release,destroy:L};return Y.data("Jcrop",ct),ct},t.fn.Jcrop=function(e){function i(i){var n=e.useImg||i.src,o=new Image;o.onload=function(){t.Jcrop(i,e)},o.src=n}return"object"!=typeof e&&(e={}),this.each(function(){if(t(this).data("Jcrop")){if("api"==e)return t(this).data("Jcrop");t(this).data("Jcrop").setOptions(e)}else i(this)}),this}})(jQuery),function(t,e){t.fn.zyPopup=function(e,i){var n=Array.prototype.slice.call(arguments,1);if("string"==typeof e){var o=this[0][e];if(t.isFunction(o))return o.apply(this,n);throw"zyPopup - No such method: "+e}return this.each(function(){var i={},n="",o="",a=!1,s="",r="",l={},d={src:"",index:0,name:"",onTailor:function(t){}};i=t.extend(d,e),this.init=function(){this.createHtml(),this.openPopup(),this.bindPopupEvent()},this.createHtml=function(){t("#zoom").remove(),t("body").append('<div id="zoom"><a class="finish"></a><a class="close"></a><div class="content loading"></div></div>'),n=t("#zoom").hide(),o=t("#zoom .content"),a=!1,null,s=t(window).width(),r=t(window).height()},this.openPopup=function(){function e(){function e(t){t.show(),o.removeClass("loading"),l.createTailorPlug()}var i=t(this),n=parseInt(o.css("borderLeftWidth")),a=s-2*n,d=r-2*n,u=i.width(),c=i.height();u==o.width()&&u<=a&&c==o.height()&&c<=d?e(i):o.animate({width:i.width(),height:i.height(),marginTop:-i.height()/2-n,marginLeft:-i.width()/2-n},200,function(){e(i)})}var l=this,d=t(new Image).attr("id","tailorImg").hide();t("#zoom .previous, #zoom .next").show(),a||(a=!0,n.show(),t("body").addClass("zoomed")),o.html(d).delay(500).addClass("loading"),d.on("load",e).attr("src",i.src)},this.createTailorPlug=function(){function e(t){l={leftX:t.x,leftY:t.y,rightX:t.x2,rightY:t.y2,width:t.w,height:t.h}}var i=t("#tailorImg").width(),n=t("#tailorImg").height(),o=i/2-i/5,a=n/2-n/5,s=i/2+i/5,r=n/2+n/5;t.Jcrop("#tailorImg",{setSelect:[o,a,s,r],onChange:e,onSelect:e})},this.bindPopupEvent=function(){var e=this;n.bind("click",function(i){i.preventDefault(),"zoom"==t(i.target).attr("id")&&e.closePopup(i)}),t("#zoom .finish").bind("click",function(n){var o=new Object;o.width=t(".jcrop-holder>div>div>img").width(),o.height=t(".jcrop-holder>div>div>img").height(),i.onTailor(l,o),e.closePopup(n)}),t("#zoom .close").bind("click",function(t){e.closePopup(t)})},this.closePopup=function(e){e&&e.preventDefault(),a=!1,null,n.hide(),t("body").removeClass("zoomed"),o.empty()},this.init()})}}(jQuery);var ZYFILE={fileInput:null,uploadInput:null,dragDrop:null,url:"",uploadFile:[],lastUploadFile:[],perUploadFile:[],fileNum:0,filterFile:function(t){return t},onSelect:function(t,e){},onDelete:function(t,e){},onProgress:function(t,e,i){},onSuccess:function(t,e){},onFailure:function(t,e){},onComplete:function(t){},funDragHover:function(t){return t.stopPropagation(),t.preventDefault(),this["dragover"===t.type?"onDragOver":"onDragLeave"].call(t.target),this},funGetFiles:function(t){var e=this;this.funDragHover(t);var i=t.target.files||t.dataTransfer.files;e.lastUploadFile=this.uploadFile,this.uploadFile=this.uploadFile.concat(this.filterFile(i));var n=[],o=[],a=[];return $.each(e.lastUploadFile,function(t,e){o.push(e.name)}),$.each(e.uploadFile,function(t,e){a.push(e.name)}),$.each(a,function(t,i){$.inArray(i,o)<0&&n.push(e.uploadFile[t])}),this.uploadFile=n,this.funDealtFiles(),!0},funDealtFiles:function(){var t=this;$.each(this.uploadFile,function(e,i){i.index=t.fileNum,t.fileNum++});var e=this.uploadFile;return this.perUploadFile=this.perUploadFile.concat(this.uploadFile),this.uploadFile=this.lastUploadFile.concat(this.uploadFile),this.onSelect(e,this.uploadFile),console.info("继续选择"),console.info(this.uploadFile),this},funDeleteFile:function(t,e){var i=this,n=[],o=this.perUploadFile[t];return $.each(this.uploadFile,function(t,e){o!=e&&n.push(e)}),this.uploadFile=n,e&&i.onDelete(o,this.uploadFile),this.fileInput.value="",console.info("还剩这些文件没有上传:"),console.info(this.uploadFile),!0},funUploadFiles:function(){var t=this;$.each(this.uploadFile,function(e,i){t.funUploadFile(i)})},funUploadFile:function(t){var e=this,i=new FormData;i.append("file",t),$("#uploadTailor_"+t.index).length>0&&i.append("tailor",$("#uploadTailor_"+t.index).attr("tailor"));var n=new XMLHttpRequest;n.upload.addEventListener("progress",function(i){e.onProgress(t,i.loaded,i.total)},!1),n.addEventListener("load",function(i){e.funDeleteFile(t.index,!1),e.onSuccess(t,n.responseText),0==e.uploadFile.length&&e.onComplete("全部完成")},!1),n.addEventListener("error",function(i){e.onFailure(t,n.responseText)},!1),n.open("POST",e.url,!0),n.send(i)},funReturnNeedFiles:function(){return this.uploadFile},init:function(){var t=this;this.dragDrop&&(this.dragDrop.addEventListener("dragover",function(e){t.funDragHover(e)},!1),this.dragDrop.addEventListener("dragleave",function(e){t.funDragHover(e)},!1),this.dragDrop.addEventListener("drop",function(e){t.funGetFiles(e)},!1)),t.fileInput&&this.fileInput.addEventListener("change",function(e){t.funGetFiles(e)},!1),t.uploadInput&&this.uploadInput.addEventListener("click",function(e){t.funUploadFiles(e)},!1)}};(function(t,e){t.fn.zyUpload=function(e,i){var n=Array.prototype.slice.call(arguments,1);if("string"==typeof e){var o=this[0][e];if(t.isFunction(o))return o.apply(this,n);throw"zyUpload - No such method: "+e}return this.each(function(){var i={},n=this,o={width:"700px",height:"400px",itemWidth:"140px",itemHeight:"120px",url:"/upload/UploadAction",fileType:[],fileSize:512e5,multiple:!0,dragDrop:!0,tailor:!1,del:!0,finishDel:!1,onSelect:function(t,e){},onDelete:function(t,e){},onSuccess:function(t,e){},onFailure:function(t,e){},onComplete:function(t){}};i=t.extend(o,e),this.init=function(){this.createHtml(),this.createCorePlug()},this.createHtml=function(){var e="";e=i.multiple?"multiple":"";var o="";if(i.dragDrop)o+='<form id="uploadForm" action="'+i.url+'" method="post" enctype="multipart/form-data">',o+='\t<div class="upload_box">',o+='\t\t<div class="upload_main">',o+='\t\t\t<div class="upload_choose">',o+='\t\t\t\t<div class="convent_choice">',o+='\t\t\t\t\t<div class="andArea">',o+='\t\t\t\t\t\t<div class="filePicker">点击选择文件</div>',o+='\t\t\t\t\t\t<input id="fileImage" type="file" size="30" name="fileselect[]" '+e+">",o+="\t\t\t\t\t</div>",o+="\t\t\t\t</div>",o+='\t\t\t\t<span id="fileDragArea" class="upload_drag_area">或者将文件拖到此处</span>',o+="\t\t\t</div>",o+='\t\t\t<div class="status_bar">',o+='\t\t\t\t<div id="status_info" class="info">选中0张文件，共0B。</div>',o+='\t\t\t\t<div class="btns">',o+='\t\t\t\t\t<div class="webuploader_pick">继续选择</div>',o+='\t\t\t\t\t<div class="upload_btn">开始上传</div>',o+="\t\t\t\t</div>",o+="\t\t\t</div>",o+='\t\t\t<div id="preview" class="upload_preview"></div>',o+="\t\t</div>",o+='\t\t<div class="upload_submit">',o+='\t\t\t<button type="button" id="fileSubmit" class="upload_submit_btn">确认上传文件</button>',o+="\t\t</div>",o+='\t\t<div id="uploadInf" class="upload_inf"></div>',o+="\t</div>",o+="</form>";else{var a=parseInt(i.itemWidth.replace("px",""))-15;o+='<form id="uploadForm" action="'+i.url+'" method="post" enctype="multipart/form-data">',o+='\t<div class="upload_box">',o+='\t\t<div class="upload_main single_main">',o+='\t\t\t<div class="status_bar">',o+='\t\t\t\t<div id="status_info" class="info">选中0张文件，共0B。</div>',o+='\t\t\t\t<div class="btns">',o+='\t\t\t\t\t<input id="fileImage" type="file" size="30" name="fileselect[]" '+e+">",o+='\t\t\t\t\t<div class="webuploader_pick">选择文件</div>',o+='\t\t\t\t\t<div class="upload_btn">开始上传</div>',o+="\t\t\t\t</div>",o+="\t\t\t</div>",o+='\t\t\t<div id="preview" class="upload_preview">',o+='\t\t\t\t<div class="add_upload">',o+='\t\t\t\t\t<a style="height:'+i.itemHeight+";width:"+i.itemWidth+';" title="点击添加文件" id="rapidAddImg" class="add_imgBox" href="javascript:void(0)">',o+='\t\t\t\t\t\t<div class="uploadImg" style="width:'+a+'px">',o+='\t\t\t\t\t\t\t<img class="upload_image" src="zyupload/skins/images/add_img.png" style="width:expression(this.width > '+a+" ? "+a+'px : this.width)" />',o+="\t\t\t\t\t\t</div>",o+="\t\t\t\t\t</a>",o+="\t\t\t\t</div>",o+="\t\t\t</div>",o+="\t\t</div>",o+='\t\t<div class="upload_submit">',o+='\t\t\t<button type="button" id="fileSubmit" class="upload_submit_btn">确认上传文件</button>',o+="\t\t</div>",o+='\t\t<div id="uploadInf" class="upload_inf"></div>',o+="\t</div>",o+="</form>"}t(n).append(o).css({width:i.width,height:i.height}),this.addEvent()},this.funSetStatusInfo=function(e){var i=0,n=e.length;t.each(e,function(t,e){i+=e.size}),i=i>1048576?(Math.round(100*i/1048576)/100).toString()+"MB":(Math.round(100*i/1024)/100).toString()+"KB",t("#status_info").html("选中"+n+"张文件，共"+i+"。")},this.funFilterEligibleFile=function(t){for(var e,n=[],o=0;e=t[o];o++){var a=e.name.split("").reverse().join("");if(null!=a.split(".")[0]){var s=a.split(".")[0].split("").reverse().join("");jQuery.inArray(s,i.fileType)>-1?e.size>=i.fileSize?alert('您这个"'+e.name+'"文件大小过大'):n.push(e):alert('您这个"'+e.name+'"上传类型不符合')}else alert('您这个"'+e.name+'"没有类型, 无法识别')}return n},this.funDisposePreviewHtml=function(t,e){var n="",o=parseInt(i.itemWidth.replace("px",""))-15,a=parseInt(i.itemHeight.replace("px",""))-10,s="",r="";i.tailor&&(s='<span class="file_edit" data-index="'+t.index+'" title="编辑"></span>'),i.del&&(r='<span class="file_del" data-index="'+t.index+'" title="删除"></span>');var l=t.name.split("").reverse().join(""),d=l.split(".")[0].split("").reverse().join(""),u="zyupload/skins/images/fileType/";return u+="rar"==d?"rar.png":"zip"==d?"zip.png":"txt"==d?"txt.png":"ppt"==d?"ppt.png":"xls"==d?"xls.png":"pdf"==d?"pdf.png":"psd"==d?"psd.png":"ttf"==d?"ttf.png":"swf"==d?"swf.png":"file.png",0==t.type.indexOf("image")?(n+='<div id="uploadList_'+t.index+'" class="upload_append_list">',n+='\t<div class="file_bar">',n+='\t\t<div style="padding:5px;">',n+='\t\t\t<p class="file_name" title="'+t.name+'">'+t.name+"</p>",n+=s,n+=r,n+="\t\t</div>",n+="\t</div>",n+='\t<a style="height:'+i.itemHeight+";width:"+i.itemWidth+';" href="#" class="imgBox">',n+='\t\t<div class="uploadImg" style="width:'+o+"px;max-width:"+o+"px;max-height:"+a+'px;">',n+='\t\t\t<img id="uploadImage_'+t.index+'" class="upload_image" src="'+e.target.result+'" style="width:expression(this.width > '+o+" ? "+o+'px : this.width);" />',n+="\t\t</div>",n+="\t</a>",n+='\t<p id="uploadProgress_'+t.index+'" class="file_progress"></p>',n+='\t<p id="uploadFailure_'+t.index+'" class="file_failure">上传失败，请重试</p>',n+='\t<p id="uploadTailor_'+t.index+'" class="file_tailor" tailor="false">裁剪完成</p>',n+='\t<p id="uploadSuccess_'+t.index+'" class="file_success"></p>',n+="</div>"):(n+='<div id="uploadList_'+t.index+'" class="upload_append_list">',n+='\t<div class="file_bar">',n+='\t\t<div style="padding:5px;">',n+='\t\t\t<p class="file_name">'+t.name+"</p>",n+=r,n+="\t\t</div>",n+="\t</div>",n+='\t<a style="height:'+i.itemHeight+";width:"+i.itemWidth+';" href="#" class="imgBox">',n+='\t\t<div class="uploadImg" style="width:'+o+'px">',n+='\t\t\t<img id="uploadImage_'+t.index+'" class="upload_file" src="'+u+'" style="width:expression(this.width > '+o+" ? "+o+'px : this.width)" />',n+="\t\t</div>",n+="\t</a>",n+='\t<p id="uploadProgress_'+t.index+'" class="file_progress"></p>',n+='\t<p id="uploadFailure_'+t.index+'" class="file_failure">上传失败，请重试</p>',n+='\t<p id="uploadSuccess_'+t.index+'" class="file_success"></p>',n+="</div>"),n},this.createPopupPlug=function(e,n,o){t("body").zyPopup({src:e,index:n,name:o,onTailor:function(e,o){var a=parseInt(i.itemWidth.replace("px","")),s=(parseInt(i.itemHeight.replace("px","")),e.width),r=e.height,l=a/s,d=l*o.width,u=l*o.height,c=e.leftX*l,p=e.rightY*l-r*l;t("#uploadImage_"+n).css({width:d,height:u,"margin-left":-c,"margin-top":-p}),t("#uploadTailor_"+n).show(),console.info(e);var f="{'leftX':"+e.leftX+",'leftY':"+e.leftY+",'rightX':"+e.rightX+",'rightY':"+e.rightY+",'width':"+e.width+",'height':"+e.height+"}";t("#uploadTailor_"+n).attr("tailor",f)}})},this.createCorePlug=function(){var e={fileInput:t("#fileImage").get(0),uploadInput:t("#fileSubmit").get(0),dragDrop:t("#fileDragArea").get(0),url:t("#uploadForm").attr("action"),filterFile:function(t){return n.funFilterEligibleFile(t)},onSelect:function(e,o){i.onSelect(e,o),n.funSetStatusInfo(ZYFILE.funReturnNeedFiles());var a="",s=0,r=function(){if(file=e[s],file){var t=new FileReader;t.onload=function(t){a+=n.funDisposePreviewHtml(file,t),s++,r()},t.readAsDataURL(file)}else l(a)},l=function(e){i.dragDrop?t("#preview").append(e):t(".add_upload").before(e),d(),u()},d=function(){t(".file_del").length>0&&t(".file_del").click(function(){return ZYFILE.funDeleteFile(parseInt(t(this).attr("data-index")),!0),!1}),t(".file_edit").length>0&&t(".file_edit").click(function(){var e=t(this).attr("data-index"),i=t(this).prev(".file_name").attr("title"),o=t("#uploadImage_"+e).attr("src");return n.createPopupPlug(o,e,i),!1})},u=function(){t(".upload_append_list").hover(function(e){t(this).find(".file_bar").addClass("file_hover")},function(e){t(this).find(".file_bar").removeClass("file_hover")})};r()},onDelete:function(e,o){i.onDelete(e,o),t("#uploadList_"+e.index).fadeOut(),n.funSetStatusInfo(o),console.info("剩下的文件"),console.info(o)},onProgress:function(e,i,n){var o=t("#uploadProgress_"+e.index),a=(i/n*100).toFixed(2)+"%";o.is(":hidden")&&o.show(),o.css("width",a)},onSuccess:function(e,o){i.onSuccess(e,o),t("#uploadProgress_"+e.index).hide(),t("#uploadSuccess_"+e.index).show(),i.finishDel&&(t("#uploadList_"+e.index).fadeOut(),n.funSetStatusInfo(ZYFILE.funReturnNeedFiles())),t("#uploadTailor_"+e.index).length>0&&t("#uploadTailor_"+e.index).hide()},onFailure:function(e,n){i.onFailure(e,n),t("#uploadProgress_"+e.index).hide(),t("#uploadSuccess_"+e.index).show(),t("#uploadTailor_"+e.index).length>0&&t("#uploadTailor_"+e.index).hide(),t("#uploadInf").append("<p>文件"+e.name+"上传失败！</p>")},onComplete:function(t){i.onComplete(t),console.info(t)},onDragOver:function(){t(this).addClass("upload_drag_hover")},onDragLeave:function(){t(this).removeClass("upload_drag_hover")}};ZYFILE=t.extend(ZYFILE,e),ZYFILE.init()},this.addEvent=function(){t(".filePicker").length>0&&t(".filePicker").bind("click",function(e){t("#fileImage").click()}),t(".webuploader_pick").bind("click",function(e){t("#fileImage").click()}),t(".upload_btn").bind("click",function(e){ZYFILE.funReturnNeedFiles().length>0?t("#fileSubmit").click():alert("请先选中文件再点击上传")}),t("#rapidAddImg").length>0&&t("#rapidAddImg").bind("click",function(e){t("#fileImage").click()})},this.init()})}})(jQuery);